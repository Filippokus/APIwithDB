# APIwithDB

## Описание

Это проект FastAPI, который использует PostgreSQL для хранения данных. В проекте предусмотрена возможность автоматического создания виртуального окружения, установки зависимостей и запуска базы данных и сервера FastAPI через `bat` файл.

## Требования

- Python 3.12
- PostgreSQL
- Установленный pgAdmin (опционально, для управления базой данных)

## Установка

### 1. Клонирование репозитория

Сначала клонируйте репозиторий на ваш локальный компьютер:

```sh
git clone https://github.com/Filippokus/APIwithDB
cd APIwithDB
```
### 2. Настройка окружения

При первом запуске вам необходимо будет указать пути к `pg_ctl` и `pg_data`, а также пользователя PostgreSQL и имя базы данных. Эти данные будут сохранены в `config.txt` для последующего использования.
По умолчанию данные `pg_ctl` находятся по пути `C:\Program Files\PostgreSQL\16\bin\pg_ctl.exe`, а `pg_data` по пути `C:\Program Files\PostgreSQL\16\data`

### 3. Запуск приложения

Запустите `run.bat` файл для настройки и запуска базы данных и сервера
#### Что выполняет `run.bat`
1. Устанавливает кодовую страницу на UTF-8.
2. Проверяет существование файла `config.txt`, если он не существует, запрашивает у пользователя пути к `pg_ctl` и `pg_data`, а также имя пользователя PostgreSQL и имя базы данных. Эти данные сохраняются в `config.txt`.
3. Загружает значения из `config.txt`.
4. Создает файл `.env` с необходимыми переменными среды для работы приложения.
5. Устанавливает виртуальное окружение Python, если оно еще не установлено.
6. Активирует виртуальное окружение.
7. Устанавливает зависимости, указанные в `requirements.txt`.
8. Запускает сервер базы данных PostgreSQL.
9. Проверяет, существует ли база данных, если нет, создает новую базу данных.
10. Проверяет, существуют ли таблицы, если нет, восстанавливает базу данных из дампа `database_dump.sql`.
11. Запускает сервер FastAPI.
12. Оставляет консоль открытой.
### Использование

После запуска `run.bat`, сервер FastAPI будет доступен по адресу `http://localhost:8000`. Вы можете использовать документацию API по адресу `http://localhost:8000/docs`.
Или по адресу `http://127.0.0.1:8000/docs`
## Остановка

Для остановки сервера базы данных и FastAPI, закройте консольное окно, в котором был запущен `run.bat`, либо сочетание клавиш ctrl+C.